## Q167
```C++
# include <bits/stdc++.h>
# define X first
# define Y second
using namespace std;
typedef long long ll;
int main(){
    ll n=1e11;
    ll sum=0;
    map<int,int>mp;
    for(int i=2;i<=10;i++){
        int even=0,even_pos=0;
        mp.clear();
        vector<int>U;U.push_back(2*i+1);
        do{
            ++mp[U.back()+2];
            if(even) ++mp[U.back()+even];
            else{
                for(int j=0;j+1<U.size();j++)
                    mp[U.back()+U[j]]++;
            }
            if(U.back()%2==0){
                even=U.back();even_pos=U.size()-1;
                for(auto & it : mp)
                    if(it.X%2==0) ++it.Y;
            }
            for(auto it=mp.begin();it!=mp.end();it++)
                if(it->Y==1){
                    U.push_back(it->X);
                    mp.erase(mp.begin(),++it);
                    break;
                }
        }while(U.back()-U[U.size()-2]!=even);
        int period=U.size()-2,diff=U.back()-U.front();
        int s=(n-3)%period;
        if(s>=even_pos) ++s;
        ll ans=(n-3)/period*diff+U[s];
        sum+=ans;
    }
    printf("%lld\n",sum);
}
/*
Schmerl和Spiegel在1994年证明：
满足n>=2的Ulam序列U(2,2n+1)有且只有两个偶数，其中一个是2，设另外一个为even.
设U'(2,2n+1)为U(2,2n+1)去掉两个偶数项后剩下的数，那么U'(2n+1)的差分序列是一个循环数组，其中最小的循环节中有且仅有一个even，并且这个even在整个循环节中的最后一个数、
*/
```
```C++
# include <bits/stdc++.h>
using namespace std;
typedef long long ll;

int a[3004],M=3000;
int main(){
    freopen("w.txt","w",stdout);
    map<int,int>mp;
    for(int n=2;n<=20;n++){
        a[1]=2;a[2]=2*n+1;
        mp.clear();
        mp[a[1]+a[2]]=1;
        for(int m=3;m<=M;m++){
            for(auto it=mp.upper_bound(a[m-1]);it!=mp.end();it++)
                if(it->second==1) {
                    a[m] = it->first;
                    break;
                }
            for(int i=1;i<m;i++)
                ++mp[a[i]+a[m]];
        }
        for(int i=2;i<=M;i++)
            printf("%d ",a[i]-a[i-1]);
        puts("");
    }
}
```
```
# include <bits/stdc++.h>
using namespace std;
typedef long long ll;
bool bits[10000];

ll cal(int b,ll n) {
    memset(bits, 0, sizeof(bits));
    b = 2 * b + 1;
    vector<int> ulam;
    ulam.push_back(2);
    ulam.push_back(b);
    bits[b >> 1] = true;
    int b0, k = 0, k0 = 1, i = 2, i0 = 0, i1, c = 2 * b + 1;
    for (b += 2; b <= c; b += 2) {
        ulam.push_back(b);
        bits[b >> 1] = true;
        i++;
    }
    c = b - 1;
    ulam.push_back(c);
    ulam.push_back(b);
    bits[b >> 1] = true;
    for (i += 2, b0 = b, b += 2;; b += 2)
        if (bits[(b - 2) >> 1] ^ bits[(b - c) >> 1]) {
            ulam.push_back(b);
            bits[b >> 1] = true;
            i++;
            if (b - b0 == c) {
                k++;
                if (k == k0++) {
                    if (k == 1) i0 = i - 2;

                    if (k == 2) {
                        i1 = i - 2;
                        int p = i1 - i0, d = ulam[i1] - ulam[i0];
                        printf("%d %d %d %d\n", i0, i1, ulam[i0], ulam[i1]);
                        for (int i = 0; i < ulam.size(); i++)
                            if (ulam[i] % 2 == 0)
                                printf("EVEN %d %d\n", i + 1, ulam[i]);
                        printf("%d\n", p);
                        return (n - i0) / p * d + ulam[(int) ((n - i0) % p) + p + 1];
                    }
                }
            }
            b0 = b;
        }
}
int main() {
    freopen("w.txt", "w", stdout);
    ll r = 0, n = (ll) 1e11 - 1;
    for (int b = 2; b <= 2; b++)
        r += cal(b, n);
    printf("%lld\n", r);
}
```