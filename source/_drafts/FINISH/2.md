SECFLOAT

IEEE754标准：$p=8$比特的指数部分和$q=23$比特的尾数部分。

MKL库计算标准数学函数的三步，以$z=2^x,x\in[-126,127]$为例：

1. range reduction: 首先计算$N$和$f$满足 ，其中$N$是整数，$f\in[0,1)$；
2. polynomial approximations：对于$f\in[0,1)$利用多项式近似$y=2^f$；
3. output compensation：计算$2^N\cdot y$ 。

给定浮点数$\alpha$，在参数$p,q$确定下，表示为四元组$(z,s,e,m)$：

- $z\in\{0,1\}:1\{\alpha=0\}$
- $s\in\{0,1\}:1\{\alpha<0\}$
- $e\in\{0,1\}^{p+2}: $指数部分的有符号表示，取值范围$[-2^{p-1}+1,2^{p-1}]$
- $m\in\{0,1\}^{q+1}: $正则化的尾数无符号表示，取值范围$[2^q,2^{q+1}-1]\cup\{0\}$

真实值：$(1-z)\cdot(1-2s)\cdot 2^{\mathrm{int}_{p+2}(e)}\cdot\langle m\rangle _{q+1,q} $

SECFLOAT使用SIRNN的2PC协议构建底层基本算子，如下：

|||
|-|-|
|MUX|$z=c?x:y$|
|OR|$z=x\lor y$|
|EQ|$1\{x=y\}$|
|GT|$1\{x>y\}$|
|LUT|$y=L(x)$|
|TR|$TR(x,s),x$的最高$\ell-s$位|
|UMult|$x*_\ell y$|
|SMult|$x*_\ell'y$|
|MSNZB|$k,K=MSNZB(x),k,\text{s.t.} x_k=1\land \forall i>k,x_i=0,K=2^{l-k-1}$|

SECFLOAT为这套浮点数编码设计了一套计算规则：

- 判断上溢和下溢FPCheck
- 浮点进位Rounding
- 加减法（对阶，尾数做定点数加减法，和IEEE754标准相同）
- 乘法（指数做加法，尾数做定点数乘法，和IEEE754标准相同）
- 除法（指数做减法，尾数做定点数除法，使用牛顿迭代法进行）

SECFLOAT先实现了一个用于计算多项式分段函数的协议GetC。非线性函数将使用分段的线性函数进行近似。


GetC协议有$3$个参数，分别如下：

- $x$：多项式的自变量
- $\Theta$：分段多项式的系数矩阵，$\theta_{i}^{(j)}$表示第$j$个分段下$i$次项的系数。
- $K$：分段多项式的区间范围。$[k_j,k_{j+1}]$表示第$j$个分段的区间。

$\sin,\tan,\log,2^x$都使用了分段函数进行近似。以Sine为例，计算$\sin \pi(\delta)$时，假设$\delta\in[0,0.5),\delta=(z,s,e,m)$。如果$e<-14$，那么$\sin \pi(\delta)=\pi\cdot\delta$来近似。否则将用一个分段多项式函数来近似。

1. 如果$\delta \in[2^{-14},2^{-5})$，那么分段函数由指数的低$4$比特决定。
2. 如果$\delta \in[2^{-5},2^{-1}]$，那么分段函数由指数的低$2$比特和尾数的高$5$比特决定。

以tan为例，计算$\tan \pi(\delta)$时，假设$\delta\in[0,2^{-9}]$。（需要注意，$\tan\beta=\dfrac{1}{\tan (\dfrac{\pi}{2}-\beta)}$）。那么计算$\tan\delta$时，采用公式：

$$\tan\pi(\frac{N}{512}+\delta)=\dfrac{\tan\pi(\frac{N}{512})+\tan\pi(\delta)}{1-\tan\pi(\frac{N}{512})\cdot \tan\pi(\delta)}$$

结合计算。

$\tan\pi(\frac{N}{512})$通过查表直接计算得出，$\tan\pi(\delta)$通过指数的最后$3$比特和尾数的前$2$比特决定多项式的分段。

$\log$和$2^x$类似。

计划：通过上面这种Functionality的构造方法，如法炮制出$\sinh,\cosh,\tanh,e^x,\text{sigmoid},\arcsin,\arccos,\arctan$的计算方法。

甚至计算伽马函数$\Gamma(z)$，令$x=\tan t$：

$$\begin{aligned}
\Gamma(z)&=\int_{0}^{\infty} e^{-x}\cdot x^{s-1}dx\\
&=\int_{0}^{\frac{\pi}{2}} e^{-\tan t} \cdot \tan^{s-1} t(1+\tan^2t) dt
\end{aligned}$$

后用矩形面积来近似。