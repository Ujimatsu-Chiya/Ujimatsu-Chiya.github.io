<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ujimatsu-chiya.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"vs","dark":"vs2015"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="article">
<meta property="og:title" content="Project Euler 815">
<meta property="og:url" content="https://ujimatsu-chiya.github.io/project-euler/815/index.html">
<meta property="og:site_name" content="Ujimatsu Chiya">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2026-01-21T11:57:02.000Z">
<meta property="article:modified_time" content="2026-01-21T11:57:02.705Z">
<meta property="article:author" content="Ujimatsu Chiya">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://ujimatsu-chiya.github.io/project-euler/815/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://ujimatsu-chiya.github.io/project-euler/815/","path":"project-euler/815/","title":"Project Euler 815"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Project Euler 815 | Ujimatsu Chiya</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js" defer></script>
  <script async src="https://hm.baidu.com/hm.js?b51c0caaa35b7e7749207556edb4b772"></script>







  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/pjax.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>




  <script src="/js/third-party/fancybox.js" defer></script>



  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Ujimatsu Chiya</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-project-euler"><a href="/project-euler/" rel="section"><i class="fa fa-align-justify fa-fw"></i>Project Euler</a></li><li class="menu-item menu-item-算法导论"><a href="/introduction-to-algorithms/" rel="section"><i class="fa-solid fa-question fa-fw"></i>算法导论</a></li><li class="menu-item menu-item-友情链接"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友情链接</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#project-euler-815"><span class="nav-number">1.</span> <span class="nav-text">Project Euler 815</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE"><span class="nav-number">1.1.</span> <span class="nav-text">题目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#group-by-value"><span class="nav-number">1.1.1.</span> <span class="nav-text">Group by Value</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">1.2.</span> <span class="nav-text">解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A6%82%E7%8E%87%E9%80%92%E6%8E%A8%E6%96%B9%E7%A8%8B"><span class="nav-number">1.3.</span> <span class="nav-text">6. 概率递推方程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">1.4.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ujimatsu Chiya"
      src="/images/chiya.png">
  <p class="site-author-name" itemprop="name">Ujimatsu Chiya</p>
  <div class="site-description" itemprop="description">Ujimatsu Chiya 的博客还在建造当中，什么都会整一些上来哦</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">773</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Ujimatsu-Chiya" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Ujimatsu-Chiya" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://leetcode.cn/u/ujimatsu_chiya/" title="Leetcode → https:&#x2F;&#x2F;leetcode.cn&#x2F;u&#x2F;ujimatsu_chiya&#x2F;" rel="noopener me" target="_blank"><i class="fa custom leetcode fa-fw"></i>Leetcode</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.xiaohongshu.com/user/profile/6423968900000000110225fd" title="Xiaohongshu → https:&#x2F;&#x2F;www.xiaohongshu.com&#x2F;user&#x2F;profile&#x2F;6423968900000000110225fd" rel="noopener me" target="_blank"><i class="fa custom xiaohongshu fa-fw"></i>Xiaohongshu</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ujimatsu-chiya.github.io/project-euler/815/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/chiya.png">
      <meta itemprop="name" content="Ujimatsu Chiya">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ujimatsu Chiya">
      <meta itemprop="description" content="Ujimatsu Chiya 的博客还在建造当中，什么都会整一些上来哦">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Project Euler 815 | Ujimatsu Chiya">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Project Euler 815
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-21 19:57:02" itemprop="dateCreated datePublished" datetime="2026-01-21T19:57:02+08:00">2026-01-21</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Project-Euler/" itemprop="url" rel="index"><span itemprop="name">Project Euler</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.5k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>2 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><escape><span id="more"></span></escape></p>
<h1 id="project-euler-815">Project Euler 815</h1>
<h2 id="题目">题目</h2>
<h3 id="group-by-value">Group by Value</h3>
<p>A pack of cards contains <span class="math inline">\(4n\)</span>
cards with four identical cards of each value. The pack is shuffled and
cards are dealt one at a time and placed in piles of equal value. If the
card has the same value as any pile it is placed in that pile. If there
is no pile of that value then it begins a new pile. When a pile has four
cards of the same value it is removed.</p>
<p>Throughout the process the maximum number of non empty piles is
recorded. Let <span class="math inline">\(E(n)\)</span> be its expected
value. You are given <span class="math inline">\(E(2) =
1.97142857\)</span> rounded to <span class="math inline">\(8\)</span>
decimal places.</p>
<p>Find <span class="math inline">\(E(60)\)</span>. Give your answer
rounded to <span class="math inline">\(8\)</span> digits after the
decimal point.</p>
<h2 id="解决方案">解决方案</h2>
<p>对每一种点数而言，在任意时刻它已经出现的张数只能是 <span
class="math inline">\(0,1,2,3,4\)</span> 之一。令<span
class="math inline">\(C_i (i=0,1,2,3,4)\)</span>表示当前“已出现 <span
class="math inline">\(i\)</span>
张”的点数种类数量。显然恒有守恒关系<span
class="math inline">\(C_0+C_1+C_2+C_3+C_4=n.\)</span></p>
<p>桌面上的“非空堆”恰好对应那些出现次数为 <span
class="math inline">\(1,2,3\)</span> 的点数，因此此刻非空堆数量为<span
class="math inline">\(P=C_1+C_2+C_3.\)</span></p>
<p>其中 <span class="math inline">\(C_4\)</span> 表示已经完整出现 <span
class="math inline">\(4\)</span>
次的点数，它们的堆已被移除，不再贡献非空堆数。</p>
<p>设已发出 <span class="math inline">\(t\)</span>
张牌，则剩余牌数为<span
class="math inline">\(L=4n-t.\)</span>若某点数已经出现了 <span
class="math inline">\(i\)</span> 张，则仍有 <span
class="math inline">\(4-i\)</span> 张留在牌堆中；因此“下一张牌来自已出现
<span class="math inline">\(i\)</span> 张的点数”的总可能牌数为 <span
class="math inline">\((4-i)C_i\)</span>。</p>
<p>于是对于 <span class="math inline">\(i=0,1,2,3\)</span>
可以得到下一张来自出现<span
class="math inline">\(i\)</span>张的点数的概率为<span
class="math inline">\(\dfrac{(4-i)C_i}{L}\)</span>，并且有一致性恒等式<span
class="math inline">\(4C_0+3C_1+2C_2+C_3=L,\)</span>这恰好保证上述四种情况概率和为
<span class="math inline">\(1\)</span>。</p>
<p>抽到不同类别的点数，会使其出现次数加一，具体为：</p>
<ul>
<li><span class="math inline">\(0\to 1\)</span>：<span
class="math inline">\((C_0,C_1)\mapsto(C_0-1,C_1+1),\)</span></li>
<li><span class="math inline">\(1\to 2\)</span>：<span
class="math inline">\((C_1,C_2)\mapsto(C_1-1,C_2+1),\)</span></li>
<li><span class="math inline">\(2\to 3\)</span>：<span
class="math inline">\((C_2,C_3)\mapsto(C_2-1,C_3+1),\)</span></li>
<li><span class="math inline">\(3\to 4\)</span>（堆移除）：<span
class="math inline">\((C_3,C_4)\mapsto(C_3-1,C_4+1).\)</span></li>
</ul>
<p>从非空堆数 <span class="math inline">\(P=C_1+C_2+C_3\)</span>
的角度看，变化规律为：</p>
<ul>
<li><span class="math inline">\(0\to 1\)</span>：<span
class="math inline">\(P\)</span> 增加 <span
class="math inline">\(1\)</span>；</li>
<li><span class="math inline">\(1\to 2,2\to 3\)</span>：<span
class="math inline">\(P\)</span> 不变；</li>
<li><span class="math inline">\(3\to 4\)</span>：<span
class="math inline">\(P\)</span> 减少 <span
class="math inline">\(1\)</span>。</li>
</ul>
<p>为了得到 <span class="math inline">\(M=\max \{P\}\)</span>
的期望，必须记录历史最大堆数。令<span
class="math inline">\(\displaystyle{m=\max_{0\le s\le
t}\{P(s)\}}\)</span>表示截至目前为止出现过的最大非空堆数。于是定义概率函数<span
class="math inline">\(f_t(c_1,c_2,c_3,m)\)</span>表示在发出 <span
class="math inline">\(t\)</span> 张牌后，系统满足<span
class="math inline">\(C_1=c_1,C_2=c_2,C_3=c_3\)</span>，且历史最大非空堆数为
<span class="math inline">\(m\)</span>的概率。那么初始条件是<span
class="math inline">\(f_0(0,0,0,0)=1.\)</span></p>
<p>为了使递推只依赖 <span
class="math inline">\((c_1,c_2,c_3)\)</span>，注意到发出的总牌数满足<span
class="math inline">\(t=1\cdot C_1+2\cdot C_2+3\cdot C_3+4\cdot
C_4.\)</span>因此当已知 <span
class="math inline">\((t,c_1,c_2,c_3)\)</span> 时，<span
class="math inline">\(C_4=\dfrac{t-(c_1+2c_2+3c_3)}{4}.\)</span>进而由总数守恒得<span
class="math inline">\(C_0=n-c_1-c_2-c_3-C_4.\)</span></p>
<p>在所有可达状态中，<span class="math inline">\(C_4\)</span>
必为非负整数，且 <span class="math inline">\(C_0\ge
0\)</span>。令当前非空堆数为<span
class="math inline">\(p=c_1+c_2+c_3,\)</span>剩余牌数为<span
class="math inline">\(L=4n-t.\)</span></p>
<hr />
<h2 id="概率递推方程">6. 概率递推方程</h2>
<p>从状态 <span class="math inline">\((c_1,c_2,c_3,m)\)</span>
出发，下一张牌有四种类型，其概率分别为<span
class="math inline">\(\dfrac{4C_0}{L},\dfrac{3c_1}{L},\dfrac{2c_2}{L},\dfrac{c_3}{L}.\)</span></p>
<p>对应的状态转移为：</p>
<ol type="1">
<li>抽到一个“未出现过”的点数（<span class="math inline">\(0\to
1\)</span>）：<span
class="math inline">\((c_1,c_2,c_3,m)\mapsto(c_1+1,c_2,c_3,\max(m,p+1)).\)</span></li>
<li>抽到一个“已出现 1 张”的点数（<span class="math inline">\(1\to
2\)</span>）：<span
class="math inline">\((c_1,c_2,c_3,m)\mapsto(c_1-1,c_2+1,c_3,m).\)</span></li>
<li>抽到一个“已出现 2 张”的点数（<span class="math inline">\(2\to
3\)</span>）：<span
class="math inline">\((c_1,c_2,c_3,m)\mapsto(c_1,c_2-1,c_3+1,m).\)</span></li>
<li>抽到一个“已出现 3 张”的点数（<span class="math inline">\(3\to
4\)</span>，堆移除）：<span
class="math inline">\((c_1,c_2,c_3,m)\mapsto(c_1,c_2,c_3-1,m).\)</span></li>
</ol>
<p>因此递推关系可以写成对所有合法参数的求和形式：</p>
<p><span class="math display">\[
f_{t+1}(c_1&#39;,c_2&#39;,c_3&#39;,m&#39;)=\sum_{(c_1,c_2,c_3,m)}f_t(c_1,c_2,c_3,m)\cdot
\Pr\{(c_1,c_2,c_3,m)\to(c_1&#39;,c_2&#39;,c_3&#39;,m&#39;)\}.
\]</span></p>
<p>更具体地，若把四类转移分别展开，则由上面的四种映射可直接累加得到
<span class="math inline">\(f_{t+1}\)</span>。</p>
<p>当 <span class="math inline">\(t=4n\)</span>
时，牌已全部发完，系统过程终止，历史最大堆数 <span
class="math inline">\(m\)</span> 已成为最终随机变量 <span
class="math inline">\(M\)</span> 的取值。因此期望为</p>
<p><span class="math display">\[
E(n)=\sum_{c_1,c_2,c_3,m} m\cdot f_{4n}(c_1,c_2,c_3,m).
\]</span></p>
<h2 id="代码">代码</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">N = <span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">expected_max_piles</span>(<span class="params">n: <span class="built_in">int</span></span>) -&gt; <span class="built_in">float</span>:</span><br><span class="line">    inf = <span class="built_in">float</span>(<span class="string">&#x27;inf&#x27;</span>)</span><br><span class="line">    f = defaultdict(<span class="built_in">float</span>)</span><br><span class="line">    f[(<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)] = <span class="number">1.0</span></span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span> * n):</span><br><span class="line">        left = <span class="number">4</span> * n - t</span><br><span class="line">        nf = defaultdict(<span class="built_in">float</span>)</span><br><span class="line">        <span class="keyword">for</span> (c1, c2, c3, mp), p <span class="keyword">in</span> f.items():</span><br><span class="line">            x = t - (c1 + <span class="number">2</span> * c2 + <span class="number">3</span> * c3)</span><br><span class="line">            <span class="keyword">if</span> x &lt; <span class="number">0</span> <span class="keyword">or</span> x &amp; <span class="number">3</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            c4 = x &gt;&gt; <span class="number">2</span></span><br><span class="line">            c0 = n - c1 - c2 - c3 - c4</span><br><span class="line">            <span class="keyword">if</span> c0 &lt; <span class="number">0</span>:</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            piles = c1 + c2 + c3</span><br><span class="line">            <span class="keyword">if</span> c0:</span><br><span class="line">                q = (<span class="number">4</span> * c0) / left</span><br><span class="line">                mp2 = <span class="built_in">max</span>(mp, piles + <span class="number">1</span>)</span><br><span class="line">                nf[(c1 + <span class="number">1</span>, c2, c3, mp2)] += p * q</span><br><span class="line">            <span class="keyword">if</span> c1:</span><br><span class="line">                q = (<span class="number">3</span> * c1) / left</span><br><span class="line">                nf[(c1 - <span class="number">1</span>, c2 + <span class="number">1</span>, c3, mp)] += p * q</span><br><span class="line">            <span class="keyword">if</span> c2:</span><br><span class="line">                q = (<span class="number">2</span> * c2) / left</span><br><span class="line">                nf[(c1, c2 - <span class="number">1</span>, c3 + <span class="number">1</span>, mp)] += p * q</span><br><span class="line">            <span class="keyword">if</span> c3:</span><br><span class="line">                q = c3 / left</span><br><span class="line">                nf[(c1, c2, c3 - <span class="number">1</span>, mp)] += p * q</span><br><span class="line">        f = nf</span><br><span class="line">    ans = <span class="number">0.0</span></span><br><span class="line">    <span class="keyword">for</span> (_, _, _, mp), p <span class="keyword">in</span> f.items():</span><br><span class="line">        ans += mp * p</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;<span class="subst">&#123;expected_max_piles(N):<span class="number">.8</span>f&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="Ujimatsu Chiya 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="Ujimatsu Chiya 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Ujimatsu Chiya
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://ujimatsu-chiya.github.io/project-euler/815/" title="Project Euler 815">https://ujimatsu-chiya.github.io/project-euler/815/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2022 – 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Ujimatsu Chiya</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">1.7m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">25:03</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div><!-- 页面动态线条-->
<script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://lib.baomitu.com/canvas-nest.js/1.0.1/canvas-nest.js"></script>
<!-- 页面点击小红心
<script type="text/javascript" src="/js/click-love.js" />-->

<span id="sitetime"></span>
<script language=javascript>
function siteTime(){
    window.setTimeout("siteTime()", 1000);
    let seconds = 1000;
    let minutes = seconds * 60;
    let hours = minutes * 60;
    let days = hours * 24;
    let years = days * 365;
    let create_day = new Date("2022-03-25T13:14:23Z");
    let today = new Date();
    let awesome = "<i class=\"fa-solid fa-clock\"></i> "

    let diff = today-create_day;
    let diffSeconds = Math.floor(diff/seconds%60);
    let diffMinutes = Math.floor(diff/minutes%60);
    let diffHours = Math.floor(diff/hours%24);
    let diffDays = Math.floor(diff/days%365);
    let diffYears = Math.floor(diff/years);

    document.getElementById("sitetime").innerHTML=`自 ${create_day.getFullYear()} 年 ${create_day.getMonth() + 1} 月 ${create_day.getDate()} 日建立以来，本网站已运行： ${awesome} ${diffYears} 年 ${diffDays} 天 ${diffHours} 时 ${diffMinutes} 分 ${diffSeconds} 秒`;
}
siteTime();
</script>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"Ujimatsu-Chiya/Ujimatsu-Chiya.github.io-comment","issue_term":"pathname","theme":"github-light","crossorigin":"anonymous"}</script>
<script src="/js/third-party/comments/utterances.js" defer></script>

</body>
</html>
