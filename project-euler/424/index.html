<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ujimatsu-chiya.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"vs","dark":"vs2015"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="article">
<meta property="og:title" content="Project Euler 424">
<meta property="og:url" content="https://ujimatsu-chiya.github.io/project-euler/424/index.html">
<meta property="og:site_name" content="Ujimatsu Chiya">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://ujimatsu-chiya.github.io/project-euler/resources/images/0424_kakuro1.gif">
<meta property="article:published_time" content="2026-01-13T15:53:09.000Z">
<meta property="article:modified_time" content="2026-01-13T15:53:09.955Z">
<meta property="article:author" content="Ujimatsu Chiya">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://ujimatsu-chiya.github.io/project-euler/resources/images/0424_kakuro1.gif">


<link rel="canonical" href="https://ujimatsu-chiya.github.io/project-euler/424/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://ujimatsu-chiya.github.io/project-euler/424/","path":"project-euler/424/","title":"Project Euler 424"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Project Euler 424 | Ujimatsu Chiya</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js" defer></script>
  <script async src="https://hm.baidu.com/hm.js?b51c0caaa35b7e7749207556edb4b772"></script>







  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/pjax.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>




  <script src="/js/third-party/fancybox.js" defer></script>



  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Ujimatsu Chiya</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-project-euler"><a href="/project-euler/" rel="section"><i class="fa fa-align-justify fa-fw"></i>Project Euler</a></li><li class="menu-item menu-item-算法导论"><a href="/introduction-to-algorithms/" rel="section"><i class="fa-solid fa-question fa-fw"></i>算法导论</a></li><li class="menu-item menu-item-友情链接"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友情链接</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#project-euler-424"><span class="nav-number">1.</span> <span class="nav-text">Project Euler 424</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE"><span class="nav-number">1.1.</span> <span class="nav-text">题目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#kakuro"><span class="nav-number">1.1.1.</span> <span class="nav-text">Kakuro</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">1.2.</span> <span class="nav-text">解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">1.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ujimatsu Chiya"
      src="/images/chiya.png">
  <p class="site-author-name" itemprop="name">Ujimatsu Chiya</p>
  <div class="site-description" itemprop="description">Ujimatsu Chiya 的博客还在建造当中，什么都会整一些上来哦</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">727</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Ujimatsu-Chiya" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Ujimatsu-Chiya" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://leetcode.cn/u/ujimatsu_chiya/" title="Leetcode → https:&#x2F;&#x2F;leetcode.cn&#x2F;u&#x2F;ujimatsu_chiya&#x2F;" rel="noopener me" target="_blank"><i class="fa custom leetcode fa-fw"></i>Leetcode</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.xiaohongshu.com/user/profile/6423968900000000110225fd" title="Xiaohongshu → https:&#x2F;&#x2F;www.xiaohongshu.com&#x2F;user&#x2F;profile&#x2F;6423968900000000110225fd" rel="noopener me" target="_blank"><i class="fa custom xiaohongshu fa-fw"></i>Xiaohongshu</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ujimatsu-chiya.github.io/project-euler/424/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/chiya.png">
      <meta itemprop="name" content="Ujimatsu Chiya">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ujimatsu Chiya">
      <meta itemprop="description" content="Ujimatsu Chiya 的博客还在建造当中，什么都会整一些上来哦">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Project Euler 424 | Ujimatsu Chiya">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Project Euler 424
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-13 23:53:09" itemprop="dateCreated datePublished" datetime="2026-01-13T23:53:09+08:00">2026-01-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Project-Euler/" itemprop="url" rel="index"><span itemprop="name">Project Euler</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><escape><span id="more"></span></escape></p>
<h1 id="project-euler-424">Project Euler 424</h1>
<h2 id="题目">题目</h2>
<h3 id="kakuro">Kakuro</h3>
<p><img data-src="../resources/images/0424_kakuro1.gif" /></p>
<p>The above is an example of a cryptic kakuro (also known as cross
sums, or even sums cross) puzzle, with its final solution on the right.
(The common rules of kakuro puzzles can be found easily on numerous
internet sites. Other related information can also be currently found at
<a target="_blank" rel="noopener" href="http://krazydad.com/">krazydad.com</a> whose author has
provided the puzzle data for this challenge.)</p>
<p>The downloadable text file <a
href="../resources/documents/0424_kakuro200.txt">kakuro200.txt</a>
contains the description of <span class="math inline">\(200\)</span>
such puzzles, a mix of <span class="math inline">\(5\times5\)</span> and
<span class="math inline">\(6\times6\)</span> types. The first puzzle in
the file is the above example which is coded as follows:</p>
<p><code>6,X,X,(vCC),(vI),X,X,X,(hH),B,O,(vCA),(vJE),X,(hFE,vD),O,O,O,O,(hA),O,I,(hJC,vB),O,O,(hJC),H,O,O,O,X,X,X,(hJE),O,O,X</code></p>
<p>The first character is a numerical digit indicating the size of the
information grid. It would be either a <span
class="math inline">\(6\)</span> (for a <span
class="math inline">\(5\times5\)</span> kakuro puzzle) or a <span
class="math inline">\(7\)</span> (for a <span
class="math inline">\(6\times6\)</span> puzzle) followed by a comma (,).
The extra top line and left column are needed to insert information.</p>
<p>The content of each cell is then described and followed by a comma,
going left to right and starting with the top line.</p>
<p><span class="math inline">\(X\)</span> = Gray cell, not required to
be filled by a digit.</p>
<p><span class="math inline">\(O\)</span> (upper case letter)= White
empty cell to be filled by a digit.</p>
<p><span class="math inline">\(A\)</span> = Or any one of the upper case
letters from A to J to be replaced by its equivalent digit in the solved
puzzle.</p>
<p><span class="math inline">\(( )\)</span> = Location of the encrypted
sums. Horizontal sums are preceded by a lower case “h” and vertical sums
are preceded by a lower case “v”. Those are followed by one or two upper
case letters depending if the sum is a single digit or double digit one.
For double digit sums, the first letter would be for the “tens” and the
second one for the “units”. When the cell must contain information for
both a horizontal and a vertical sum, the first one is always for the
horizontal sum and the two are separated by a comma within the same set
of brackets, ex.: (hFE,vD). Each set of brackets is also immediately
followed by a comma.</p>
<p>The description of the last cell is followed by a Carriage
Return/Line Feed (CRLF) instead of a comma.</p>
<p>The required answer to each puzzle is based on the value of each
letter necessary to arrive at the solution and according to the
alphabetical order. As indicated under the example puzzle, its answer
would be <span class="math inline">\(8426039571\)</span>. At least <span
class="math inline">\(9\)</span> out of the <span
class="math inline">\(10\)</span> encrypting letters are always part of
the problem description. When only <span
class="math inline">\(9\)</span> are given, the missing one must be
assigned the remaining digit.</p>
<p>You are given that the sum of the answers for the first <span
class="math inline">\(10\)</span> puzzles in the file is <span
class="math inline">\(64414157580\)</span>.</p>
<p>Find the sum of the answers for the <span
class="math inline">\(200\)</span> puzzles.</p>
<h2 id="解决方案">解决方案</h2>
<p>可见，这一类问题最自然的方式是把它写成有限域约束满足问题（CSP）：每个格子或字母都是变量，规则就是约束；交给约束求解器做搜索与剪枝即可。每个
puzzle 是一个 <span class="math inline">\(n\times n\)</span>
的“信息网格”。其中 <span class="math inline">\(n=6\)</span> 对应原题的
<span class="math inline">\(5\times 5\)</span>，<span
class="math inline">\(n=7\)</span> 对应原题的 <span
class="math inline">\(6\times
6\)</span>（因为额外一行一列用于放线索）。</p>
<p>每个单元格 token 有几类：</p>
<ul>
<li><span
class="math inline">\(X\)</span>：灰格，不填数字，可能用于分隔连续段。</li>
<li><span class="math inline">\(O\)</span>：白空格，需要填入 <span
class="math inline">\(1\sim 9\)</span> 的数字。</li>
<li>字母 <span class="math inline">\(A\sim
J\)</span>：白格，但其数字必须等于该字母映射值。</li>
<li><span class="math inline">\(()\)</span>：线索格。例如 <span
class="math inline">\((h\overline{FE})\)</span>
表示“从该格右边连续白格构成的横向连续段的和是两位数 <span
class="math inline">\(\overline{FE}\)</span>”，也有可能只有一位如 <span
class="math inline">\((v\overline{D})\)</span>，不过<span
class="math inline">\(v\)</span>则表示该格下边连续的白格子，同一格可同时给出横、纵线索。</li>
</ul>
<p>为了把 puzzle 变成
CSP，需要把所有未知量变成整数变量，并给每个变量一个取值域。</p>
<p>题目要求 <span class="math inline">\(A\sim J\)</span> 是 <span
class="math inline">\(10\)</span> 个不同数字的置换，因此定义：</p>
<ul>
<li>对每个字母 <span
class="math inline">\(L\in\{A,\dots,J\}\)</span>，定义整数变量<span
class="math inline">\(\ell_L \in \{0,1,2,\dots,9\}.\)</span></li>
<li>全局全不同约束：<span
class="math inline">\(\text{AllDifferent}(\ell_A,\ell_B,\dots,\ell_J).\)</span></li>
</ul>
<p>这一步已经把“加密字母是一一对应的数字置换”完整表达出来。</p>
<p>对每个白格坐标 <span class="math inline">\((i,j)\)</span>（token 为
<span class="math inline">\(O\)</span> 或字母 <span
class="math inline">\(A\sim J\)</span>），定义格子变量<span
class="math inline">\(c_{i,j} \in \{1,2,\dots,9\}.\)</span></p>
<p>注意这里域是 <span class="math inline">\(1\sim 9\)</span>，原因是
Kakuro 白格不能为 <span class="math inline">\(0\)</span>。若该白格 token
是字母 <span
class="math inline">\(L\in\{A,\dots,J\}\)</span>，则表示该格的数字就是该字母的映射值，因此添加等式约束：<span
class="math inline">\(c_{i,j} = \ell_L.\)</span></p>
<p>由于 <span
class="math inline">\(c_{i,j}\in\{1,\dots,9\}\)</span>，这条等式会自动迫使
<span class="math inline">\(\ell_L\neq
0\)</span>。为了让约束更显式，也可以直接补上一条：<span
class="math inline">\(\ell_L \neq 0.\)</span></p>
<p>线索格中出现的字母串用于表示一个十进制数字。对一个线索代码（字符串）<span
class="math inline">\(S\)</span>：</p>
<ul>
<li>若 <span class="math inline">\(S\)</span> 长度为 <span
class="math inline">\(1\)</span>，即 <span
class="math inline">\(S=X\)</span>，则线索值为<span
class="math inline">\(\ell_X.\)</span>并且因为线索是正整数，补充约束<span
class="math inline">\(\ell_X\neq 0.\)</span></li>
<li>若 <span class="math inline">\(S\)</span> 长度为 <span
class="math inline">\(2\)</span>，即 <span
class="math inline">\(S=XY\)</span>，则线索值为两位数<span
class="math inline">\(10\ell_X+\ell_Y\)</span>并要求十位不为 <span
class="math inline">\(0\)</span>：<span class="math inline">\(\ell_X\neq
0.\)</span></li>
</ul>
<p>这样就把“线索也是由字母加密得到”的规则完全落到变量与线性表达式上。</p>
<p>注意到，Kakuro
的结构由若干横向连续段、纵向连续段组成。每个连续段是一段连续白格，起点由线索格给出。</p>
<p>遍历每个格子 <span class="math inline">\((i,j)\)</span>，若 token
是括号形式 <span
class="math inline">\(()\)</span>，解析其中可能包含的横向线索和纵向线索：</p>
<ul>
<li>若存在横向线索 <span class="math inline">\(hS\)</span>，则从 <span
class="math inline">\((i,j)\)</span> 的右侧开始，向右扫描 <span
class="math inline">\(j+1,j+2,\dots\)</span>，直到遇到非白格（<span
class="math inline">\(X\)</span>
或线索格）为止，收集这段白格对应的变量列表：<span
class="math inline">\(R = [c_{i,j+1}, c_{i,j+2}, \dots,
c_{i,j+r}].\)</span></li>
<li>若存在纵向线索 <span class="math inline">\(vS\)</span>，则从 <span
class="math inline">\((i,j)\)</span> 的下侧开始，向下扫描，得到<span
class="math inline">\(R = [c_{i+1,j}, c_{i+2,j}, \dots,
c_{i+d,j}].\)</span></li>
</ul>
<p>这一步等价于在网格中重建 Kakuro 的连续段结构。</p>
<p>对每个连续段的变量列表 <span
class="math inline">\(R=\{x_1,\dots,x_k\}\)</span>，其对应线索值为 <span
class="math inline">\(s\)</span>，必须满足两条 Kakuro 规则：</p>
<ol type="1">
<li>和约束：<span class="math inline">\(x_1+x_2+\cdots+x_k =
s.\)</span></li>
<li>互异约束（同一连续段内数字不重复）：<span
class="math inline">\(\text{AllDifferent}(x_1,\dots,x_k).\)</span></li>
</ol>
<p>其中 <span class="math inline">\(s\)</span>
是上一节定义的线性表达式（可能是 <span
class="math inline">\(\ell_X\)</span> 或 <span
class="math inline">\(10\ell_X+\ell_Y\)</span>）。</p>
<p>至此，一个 puzzle 的所有规则都被翻译成了整数变量上的线性约束与
AllDifferent 约束。</p>
<p>题目保证每个谜题可解，并且字母映射唯一（或至少足以确定 <span
class="math inline">\(A\sim J\)</span> 的十位串）。</p>
<p>由于：</p>
<ul>
<li>字母变量全排列约束保证 <span
class="math inline">\(\ell_A,\dots,\ell_J\)</span> 是 <span
class="math inline">\(0..9\)</span> 的一个置换；</li>
<li>每个白格变量限制在 <span
class="math inline">\(1..9\)</span>，且字母白格与字母变量相等；</li>
<li>每个 run 同时满足“和”等式与“互异”；</li>
</ul>
<p>因此任何可行解都严格对应一个合法的 Kakuro
填法与合法的字母到数字映射。</p>
<h2 id="代码">代码</h2>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> ortools.sat.python <span class="keyword">import</span> cp_model</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LETTERS = [<span class="built_in">chr</span>(<span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) + i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>)]</span><br><span class="line">LETTER_SET = <span class="built_in">set</span>(LETTERS)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tokenize_line</span>(<span class="params">line: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="comment"># split by commas but keep commas inside parentheses</span></span><br><span class="line">    out, cur, depth = [], [], <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> line.strip():</span><br><span class="line">        <span class="keyword">if</span> ch == <span class="string">&#x27;,&#x27;</span> <span class="keyword">and</span> depth == <span class="number">0</span>:</span><br><span class="line">            out.append(<span class="string">&#x27;&#x27;</span>.join(cur))</span><br><span class="line">            cur = []</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">if</span> ch == <span class="string">&#x27;(&#x27;</span>:</span><br><span class="line">            depth += <span class="number">1</span></span><br><span class="line">        <span class="keyword">elif</span> ch == <span class="string">&#x27;)&#x27;</span>:</span><br><span class="line">            depth -= <span class="number">1</span></span><br><span class="line">        cur.append(ch)</span><br><span class="line">    <span class="keyword">if</span> cur:</span><br><span class="line">        out.append(<span class="string">&#x27;&#x27;</span>.join(cur))</span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_grid</span>(<span class="params">line: <span class="built_in">str</span></span>):</span><br><span class="line">    tokens = tokenize_line(line)</span><br><span class="line">    n = <span class="built_in">int</span>(tokens[<span class="number">0</span>])</span><br><span class="line">    cells = tokens[<span class="number">1</span>:]</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(cells) == n * n</span><br><span class="line">    grid = np.array(cells, dtype=<span class="built_in">object</span>).reshape(n, n)</span><br><span class="line">    <span class="keyword">return</span> grid</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">parse_clues</span>(<span class="params">token: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="comment"># &quot;(hFE,vD)&quot; -&gt; [(&quot;h&quot;,&quot;FE&quot;), (&quot;v&quot;,&quot;D&quot;)]</span></span><br><span class="line">    inner = token[<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">    parts = inner.split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> parts:</span><br><span class="line">        p = p.strip()</span><br><span class="line">        res.append((p[<span class="number">0</span>], p[<span class="number">1</span>:]))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">is_white</span>(<span class="params">token: <span class="built_in">str</span></span>):</span><br><span class="line">    <span class="keyword">return</span> token == <span class="string">&#x27;O&#x27;</span> <span class="keyword">or</span> (<span class="built_in">len</span>(token) == <span class="number">1</span> <span class="keyword">and</span> token <span class="keyword">in</span> LETTER_SET)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">solve_one</span>(<span class="params">grid</span>):</span><br><span class="line">    n = grid.shape[<span class="number">0</span>]</span><br><span class="line">    model = cp_model.CpModel()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># letter variables A..J in 0..9, all different</span></span><br><span class="line">    L = &#123;ch: model.NewIntVar(<span class="number">0</span>, <span class="number">9</span>, ch) <span class="keyword">for</span> ch <span class="keyword">in</span> LETTERS&#125;</span><br><span class="line">    model.AddAllDifferent(<span class="built_in">list</span>(L.values()))</span><br><span class="line"></span><br><span class="line">    <span class="comment"># cell variables for white cells</span></span><br><span class="line">    C = &#123;&#125;  <span class="comment"># (i,j) -&gt; IntVar</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            t = grid[i, j]</span><br><span class="line">            <span class="keyword">if</span> is_white(t):</span><br><span class="line">                C[(i, j)] = model.NewIntVar(<span class="number">1</span>, <span class="number">9</span>, <span class="string">f&quot;cell_<span class="subst">&#123;i&#125;</span>_<span class="subst">&#123;j&#125;</span>&quot;</span>)  <span class="comment"># no zeros in white</span></span><br><span class="line">                <span class="keyword">if</span> t <span class="keyword">in</span> LETTER_SET:</span><br><span class="line">                    model.Add(C[(i, j)] == L[t])</span><br><span class="line">                    model.Add(L[t] != <span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># build runs from clue cells</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            t = grid[i, j]</span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> (<span class="built_in">len</span>(t) &gt;= <span class="number">2</span> <span class="keyword">and</span> t[<span class="number">0</span>] == <span class="string">&#x27;(&#x27;</span> <span class="keyword">and</span> t[-<span class="number">1</span>] == <span class="string">&#x27;)&#x27;</span>):</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">for</span> dirc, code <span class="keyword">in</span> parse_clues(t):</span><br><span class="line">                <span class="comment"># compute clue value from letters</span></span><br><span class="line">                <span class="keyword">if</span> <span class="built_in">len</span>(code) == <span class="number">1</span>:</span><br><span class="line">                    a = code[<span class="number">0</span>]</span><br><span class="line">                    model.Add(L[a] != <span class="number">0</span>)  <span class="comment"># single digit sum cannot be 0</span></span><br><span class="line">                    clue = L[a]</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    a, b = code[<span class="number">0</span>], code[<span class="number">1</span>]</span><br><span class="line">                    model.Add(L[a] != <span class="number">0</span>)  <span class="comment"># tens digit cannot be 0</span></span><br><span class="line">                    clue = model.NewIntVar(<span class="number">10</span>, <span class="number">45</span>, <span class="string">f&quot;clue_<span class="subst">&#123;i&#125;</span>_<span class="subst">&#123;j&#125;</span>_<span class="subst">&#123;dirc&#125;</span>_<span class="subst">&#123;code&#125;</span>&quot;</span>)</span><br><span class="line">                    model.Add(clue == <span class="number">10</span> * L[a] + L[b])</span><br><span class="line"></span><br><span class="line">                <span class="comment"># collect cells in the run</span></span><br><span class="line">                run = []</span><br><span class="line">                <span class="keyword">if</span> dirc == <span class="string">&#x27;h&#x27;</span>:</span><br><span class="line">                    jj = j + <span class="number">1</span></span><br><span class="line">                    <span class="keyword">while</span> jj &lt; n <span class="keyword">and</span> is_white(grid[i, jj]):</span><br><span class="line">                        run.append(C[(i, jj)])</span><br><span class="line">                        jj += <span class="number">1</span></span><br><span class="line">                <span class="keyword">else</span>:  <span class="comment"># &#x27;v&#x27;</span></span><br><span class="line">                    ii = i + <span class="number">1</span></span><br><span class="line">                    <span class="keyword">while</span> ii &lt; n <span class="keyword">and</span> is_white(grid[ii, j]):</span><br><span class="line">                        run.append(C[(ii, j)])</span><br><span class="line">                        ii += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> run:</span><br><span class="line">                    model.AddAllDifferent(run)</span><br><span class="line">                    model.Add(<span class="built_in">sum</span>(run) == clue)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># solve</span></span><br><span class="line">    solver = cp_model.CpSolver()</span><br><span class="line">    solver.parameters.max_time_in_seconds = <span class="number">10.0</span></span><br><span class="line">    solver.parameters.num_search_workers = <span class="number">8</span></span><br><span class="line"></span><br><span class="line">    status = solver.Solve(model)</span><br><span class="line">    <span class="keyword">if</span> status <span class="keyword">not</span> <span class="keyword">in</span> (cp_model.OPTIMAL, cp_model.FEASIBLE):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    ans = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> ch <span class="keyword">in</span> LETTERS:</span><br><span class="line">        ans = ans * <span class="number">10</span> + solver.Value(L[ch])</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line">path=<span class="string">&quot;0424_kakuro200.txt&quot;</span></span><br><span class="line">total = <span class="number">0</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(path, <span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> line_no, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(f, <span class="number">1</span>):</span><br><span class="line">        line = line.strip()</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> line:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        grid = parse_grid(line)</span><br><span class="line">        val = solve_one(grid)</span><br><span class="line">        <span class="keyword">if</span> val <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">raise</span> RuntimeError(<span class="string">f&quot;Puzzle <span class="subst">&#123;line_no&#125;</span> unsolved&quot;</span>)</span><br><span class="line">        total += val</span><br><span class="line"><span class="built_in">print</span>(total)</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="Ujimatsu Chiya 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="Ujimatsu Chiya 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Ujimatsu Chiya
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://ujimatsu-chiya.github.io/project-euler/424/" title="Project Euler 424">https://ujimatsu-chiya.github.io/project-euler/424/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2022 – 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Ujimatsu Chiya</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">1.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">22:47</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div><!-- 页面动态线条-->
<script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://lib.baomitu.com/canvas-nest.js/1.0.1/canvas-nest.js"></script>
<!-- 页面点击小红心
<script type="text/javascript" src="/js/click-love.js" />-->

<span id="sitetime"></span>
<script language=javascript>
function siteTime(){
    window.setTimeout("siteTime()", 1000);
    let seconds = 1000;
    let minutes = seconds * 60;
    let hours = minutes * 60;
    let days = hours * 24;
    let years = days * 365;
    let create_day = new Date("2022-03-25T13:14:23Z");
    let today = new Date();
    let awesome = "<i class=\"fa-solid fa-clock\"></i> "

    let diff = today-create_day;
    let diffSeconds = Math.floor(diff/seconds%60);
    let diffMinutes = Math.floor(diff/minutes%60);
    let diffHours = Math.floor(diff/hours%24);
    let diffDays = Math.floor(diff/days%365);
    let diffYears = Math.floor(diff/years);

    document.getElementById("sitetime").innerHTML=`自 ${create_day.getFullYear()} 年 ${create_day.getMonth() + 1} 月 ${create_day.getDate()} 日建立以来，本网站已运行： ${awesome} ${diffYears} 年 ${diffDays} 天 ${diffHours} 时 ${diffMinutes} 分 ${diffSeconds} 秒`;
}
siteTime();
</script>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"Ujimatsu-Chiya/Ujimatsu-Chiya.github.io-comment","issue_term":"pathname","theme":"github-light","crossorigin":"anonymous"}</script>
<script src="/js/third-party/comments/utterances.js" defer></script>

</body>
</html>
