<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.1.1">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.css" integrity="sha256-gkQVf8UKZgQ0HyuxL/VnacadJ+D2Kox2TCEBuNQg5+w=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"ujimatsu-chiya.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.26.0","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"vs","dark":"vs2015"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":true,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.json","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta property="og:type" content="article">
<meta property="og:title" content="Project Euler 352">
<meta property="og:url" content="https://ujimatsu-chiya.github.io/project-euler/352/index.html">
<meta property="og:site_name" content="Ujimatsu Chiya">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2026-01-13T15:52:43.000Z">
<meta property="article:modified_time" content="2026-01-13T15:52:43.493Z">
<meta property="article:author" content="Ujimatsu Chiya">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://ujimatsu-chiya.github.io/project-euler/352/">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://ujimatsu-chiya.github.io/project-euler/352/","path":"project-euler/352/","title":"Project Euler 352"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Project Euler 352 | Ujimatsu Chiya</title>
  

  <script src="/js/third-party/analytics/baidu-analytics.js" defer></script>
  <script async src="https://hm.baidu.com/hm.js?b51c0caaa35b7e7749207556edb4b772"></script>







  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/fancyapps-ui/5.0.31/fancybox/fancybox.umd.js" integrity="sha256-a+H7FYzJv6oU2hfsfDGM2Ohw/cR9v+hPfxHCLdmCrE8=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pangu/4.0.7/pangu.min.js" integrity="sha256-j+yj56cdEY2CwkVtGyz18fNybFGpMGJ8JxG3GSyO2+I=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/pjax.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>




  <script src="/js/third-party/fancybox.js" defer></script>



  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Ujimatsu Chiya</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li><li class="menu-item menu-item-project-euler"><a href="/project-euler/" rel="section"><i class="fa fa-align-justify fa-fw"></i>Project Euler</a></li><li class="menu-item menu-item-算法导论"><a href="/introduction-to-algorithms/" rel="section"><i class="fa-solid fa-question fa-fw"></i>算法导论</a></li><li class="menu-item menu-item-友情链接"><a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友情链接</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#project-euler-352"><span class="nav-number">1.</span> <span class="nav-text">Project Euler 352</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A2%98%E7%9B%AE"><span class="nav-number">1.1.</span> <span class="nav-text">题目</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#blood-tests"><span class="nav-number">1.1.1.</span> <span class="nav-text">Blood tests</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A7%A3%E5%86%B3%E6%96%B9%E6%A1%88"><span class="nav-number">1.2.</span> <span class="nav-text">解决方案</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81"><span class="nav-number">1.3.</span> <span class="nav-text">代码</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Ujimatsu Chiya"
      src="/images/chiya.png">
  <p class="site-author-name" itemprop="name">Ujimatsu Chiya</p>
  <div class="site-description" itemprop="description">Ujimatsu Chiya 的博客还在建造当中，什么都会整一些上来哦</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">727</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/Ujimatsu-Chiya" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;Ujimatsu-Chiya" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://leetcode.cn/u/ujimatsu_chiya/" title="Leetcode → https:&#x2F;&#x2F;leetcode.cn&#x2F;u&#x2F;ujimatsu_chiya&#x2F;" rel="noopener me" target="_blank"><i class="fa custom leetcode fa-fw"></i>Leetcode</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.xiaohongshu.com/user/profile/6423968900000000110225fd" title="Xiaohongshu → https:&#x2F;&#x2F;www.xiaohongshu.com&#x2F;user&#x2F;profile&#x2F;6423968900000000110225fd" rel="noopener me" target="_blank"><i class="fa custom xiaohongshu fa-fw"></i>Xiaohongshu</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://ujimatsu-chiya.github.io/project-euler/352/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/chiya.png">
      <meta itemprop="name" content="Ujimatsu Chiya">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Ujimatsu Chiya">
      <meta itemprop="description" content="Ujimatsu Chiya 的博客还在建造当中，什么都会整一些上来哦">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Project Euler 352 | Ujimatsu Chiya">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Project Euler 352
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-01-13 23:52:43" itemprop="dateCreated datePublished" datetime="2026-01-13T23:52:43+08:00">2026-01-13</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Project-Euler/" itemprop="url" rel="index"><span itemprop="name">Project Euler</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>4.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p><escape><span id="more"></span></escape></p>
<h1 id="project-euler-352">Project Euler 352</h1>
<h2 id="题目">题目</h2>
<h3 id="blood-tests">Blood tests</h3>
<p>Each one of the <span class="math inline">\(25\)</span> sheep in a
flock must be tested for a rare virus, known to affect <span
class="math inline">\(2\%\)</span> of the sheep population. An accurate
and extremely sensitive PCR test exists for blood samples, producing a
clear positive / negative result, but it is very time-consuming and
expensive.</p>
<p>Because of the high cost, the vet-in-charge suggests that instead of
performing <span class="math inline">\(25\)</span> separate tests, the
following procedure can be used instead:</p>
<p>The sheep are split into <span class="math inline">\(5\)</span>
groups of <span class="math inline">\(5\)</span> sheep in each group.
For each group, the <span class="math inline">\(5\)</span> samples are
mixed together and a single test is performed. Then,</p>
<ul>
<li>If the result is negative, all the sheep in that group are deemed to
be virus-free.</li>
<li>If the result is positive, <span class="math inline">\(5\)</span>
additional tests will be performed (a separate test for each animal) to
determine the affected individual(s).</li>
</ul>
<p>Since the probability of infection for any specific animal is only
0.02, the first test (on the pooled samples) for each group will be:</p>
<ul>
<li>Negative (and no more tests needed) with probability <span
class="math inline">\(0.98^5 = 0.9039207968\)</span>.</li>
<li>Positive (<span class="math inline">\(5\)</span> additional tests
needed) with probability <span class="math inline">\(1 - 0.9039207968 =
0.0960792032\)</span>.</li>
</ul>
<p>Thus, the expected number of tests for each group is <span
class="math inline">\(1 + 0.0960792032 \times 5 =
1.480396016\)</span>.</p>
<p>Consequently, all <span class="math inline">\(5\)</span> groups can
be screened using an average of only <span
class="math inline">\(1.480396016 \times 5 =
\mathbf{7.40198008}\)</span> tests, which represents a huge saving of
more than <span class="math inline">\(70\%\)</span> !</p>
<p>Although the scheme we have just described seems to be very
efficient, it can still be improved considerably (always assuming that
the test is sufficiently sensitive and that there are no adverse effects
caused by mixing different samples). E.g.:</p>
<ul>
<li>We may start by running a test on a mixture of all the <span
class="math inline">\(25\)</span> samples. It can be verified that in
about <span class="math inline">\(60.35\%\)</span> of the cases this
test will be negative, thus no more tests will be needed. Further
testing will only be required for the remaining <span
class="math inline">\(39.65\%\)</span> of the cases.</li>
<li>If we know that at least one animal in a group of <span
class="math inline">\(5\)</span> is infected and the first <span
class="math inline">\(4\)</span> individual tests come out negative,
there is no need to run a test on the fifth animal (we know that it must
be infected).</li>
<li>We can try a different number of groups / different number of
animals in each group, adjusting those numbers at each level so that the
total expected number of tests will be minimised.</li>
</ul>
<p>To simplify the very wide range of possibilities, there is one
restriction we place when devising the most cost-efficient testing
scheme: whenever we start with a mixed sample, all the sheep
contributing to that sample must be fully screened (i.e. a verdict of
infected / virus-free must be reached for all of them) before we start
examining any other animals. For the current example, it turns out that
the most cost-efficient testing scheme (we’ll call it the <em>optimal
strategy</em>) requires an average of just <span
class="math inline">\(\mathbf{4.155452}\)</span> tests!</p>
<p>Using the optimal strategy, let <span
class="math inline">\(T(s,p)\)</span> represent the average number of
tests needed to screen a flock of s sheep for a virus having probability
<span class="math inline">\(p\)</span> to be present in any
individual.</p>
<p>Thus, rounded to six decimal places, <span
class="math inline">\(T(25, 0.02) = 4.155452\)</span> and <span
class="math inline">\(T(25, 0.10) = 12.702124\)</span>.</p>
<p>Find <span class="math inline">\(\sum T(10000, p)\)</span> for <span
class="math inline">\(p=0.01, 0.02, 0.03, \dots 0.50\)</span>.</p>
<p>Give your answer rounded to six decimal places.</p>
<h2 id="解决方案">解决方案</h2>
<p>每次做一次 PCR 检测，结果只有 <strong>阴性/阳性</strong>
两种。题目额外限制是：一旦你对某个混样做了检测，那么<strong>参与该混样的所有羊</strong>必须先被完全判定（感染/未感染），之后才能开始检查其它羊。这条限制非常关键：它强迫策略呈现“<strong>深度优先的递归结构</strong>”：</p>
<ul>
<li>你先从未确定的羊里选出一组（大小为 <span
class="math inline">\(k\)</span>）做混检；</li>
<li>若阴性，则这 <span class="math inline">\(k\)</span>
只羊全部判为健康，接着处理剩下的羊；</li>
<li>若阳性，则你必须把这 <span class="math inline">\(k\)</span>
只羊完全查清（可以继续对子集混检、或单检），查清后才允许回到剩余羊群继续。</li>
</ul>
<p>因为每只羊独立同分布、且没有个体差异，所以一个子问题只需要由两件事决定：</p>
<ol type="1">
<li>羊的数量 <span class="math inline">\(n\)</span>；</li>
<li>我们是否“已知至少有一只感染”。</li>
</ol>
<p>于是自然得到两个 DP 状态。设单只羊感染概率为 <span
class="math inline">\(p\)</span>，令 <span class="math inline">\(q =
1-p\)</span>。定义混检阳性的概率（至少一只感染）为<span
class="math inline">\(P(n)=1-q^n=1-(1-p)^n.\)</span>定义：</p>
<ul>
<li><span class="math inline">\(F(n)\)</span>：对 <span
class="math inline">\(n\)</span>
只羊进行完全筛查的<strong>最小期望检测次数</strong>，在开始时<strong>并不知道</strong>这
<span class="math inline">\(n\)</span> 只里是否有人感染。</li>
<li><span class="math inline">\(G(n)\)</span>：对 <span
class="math inline">\(n\)</span>
只羊进行完全筛查的<strong>最小期望检测次数</strong>，但已知这 <span
class="math inline">\(n\)</span>
只里<strong>至少一只感染</strong>。</li>
</ul>
<p>首先推导<span class="math inline">\(F(n)\)</span>的转移。对一组“冷”的
<span class="math inline">\(n\)</span> 只羊，第一步选 <span
class="math inline">\(k\)</span> 只做混检（<span
class="math inline">\(1\le k\le n\)</span>），先消耗 <span
class="math inline">\(1\)</span> 次检测。</p>
<ul>
<li>阴性概率是 <span class="math inline">\(q^k\)</span>，则这 <span
class="math inline">\(k\)</span> 只全部判健康，剩下 <span
class="math inline">\(n-k\)</span> 只仍是冷问题，代价 <span
class="math inline">\(F(n-k)\)</span>。</li>
<li>阳性概率是 <span class="math inline">\(P(k)=1-q^k\)</span>，则这
<span class="math inline">\(k\)</span> 只变成“已知至少一只感染”的 warm
问题，代价 <span class="math inline">\(G(k)\)</span>；之后再做剩余 <span
class="math inline">\(n-k\)</span> 只的冷问题，代价 <span
class="math inline">\(F(n-k)\)</span>。</li>
</ul>
<p>所以该选择的期望代价为<span class="math inline">\(1 + q^k\cdot F(n-k)
+ P(k)\cdot (G(k)+F(n-k))= 1 + F(n-k) + P(k)G(k).\)</span></p>
<p>因此，我们可以写出<span
class="math inline">\(F(n)\)</span>的状态转移方程为： <span
class="math display">\[
F(n)=
\left\{\begin{aligned}
&amp;0 &amp;&amp; \text{if}\quad n=0\\
&amp;1 &amp;&amp; \text{if}\quad n=1\\
&amp;\min_{1\le k\le n}\{1+F(n-k)+P(k)G(k)\} &amp;&amp; \text{else}
\end{aligned}\right.
\]</span></p>
<p>其中，第二行<span
class="math inline">\(F(n)=1\)</span>表示单检一次；对于第三行的<span
class="math inline">\(k=n\)</span> 对应“先把全部 <span
class="math inline">\(n\)</span> 只混在一起测一次”的策略，其期望为<span
class="math inline">\(1 + P(n)G(n).\)</span></p>
<p>现在考虑 warm 状态：已知 <span class="math inline">\(n\)</span>
只中至少一只感染（事件记为 <span
class="math inline">\(E\)</span>）。</p>
<p>仍然先选 <span class="math inline">\(k\)</span> 只做混检（<span
class="math inline">\(1\le k\le n-1\)</span>），记事件 <span
class="math inline">\(A\)</span> 为“这 <span
class="math inline">\(k\)</span> 只里至少一只感染”。</p>
<p>注意到 <span class="math inline">\(A\Rightarrow E\)</span>，因此</p>
<p><span class="math display">\[
\Pr(A\mid E)=\frac{\Pr(A)}{\Pr(E)}
=\frac{P(k)}{P(n)}
=\frac{1-q^k}{1-q^n}.
\]</span></p>
<p>做完这一测（消耗 <span class="math inline">\(1\)</span>
次检测）后：</p>
<ul>
<li>若 <span class="math inline">\(A\)</span> 发生（子组阳性），则子组是
warm：代价 <span class="math inline">\(G(k)\)</span>；剩下 <span
class="math inline">\(n-k\)</span>
只并没有任何“必有感染”的信息（感染可能都在子组里），因此剩余变成
cold：代价 <span class="math inline">\(F(n-k)\)</span>。总计 <span
class="math inline">\(G(k)+F(n-k)\)</span>。</li>
<li>若 <span class="math inline">\(A\)</span>
不发生（子组阴性），由于已知整体至少一只感染，感染只能在剩余 <span
class="math inline">\(n-k\)</span> 只里，因此剩余仍是 warm：代价 <span
class="math inline">\(G(n-k)\)</span>。</li>
</ul>
<p>于是我们可以写出<span
class="math inline">\(G(n)\)</span>的状态转移方程：</p>
<p><span class="math display">\[
G(n)=
\left\{\begin{aligned}
&amp;0 &amp;&amp; \text{if}\quad n\le 1\\
&amp;\min_{1\le k\le
n-1}\left\{1+\frac{P(k)}{P(n)}\bigl(G(k)+F(n-k)\bigr)+\left(1-\frac{P(k)}{P(n)}\right)G(n-k)\right\}
&amp;&amp; \text{else}
\end{aligned}\right.
\]</span></p>
<p>至于，<span
class="math inline">\(G(1)=0\)</span>，是因为已知这一只必感染，不用再测。</p>
<p>若朴素枚举所有 <span class="math inline">\(k\)</span>，计算到 <span
class="math inline">\(n=10000\)</span> 需要 <span
class="math inline">\(O(n^2)\)</span>，对每个 <span
class="math inline">\(p\)</span> 都太慢。</p>
<p>关键观察：当 <span class="math inline">\(k\)</span> 很大时，<span
class="math inline">\(q^k\)</span>
极小，混检几乎必阳性，那么“先混检一次”带来的主要收益（直接判掉一大组全阴性）几乎不可能发生；而一旦阳性，还得进入
<span class="math inline">\(G(k)\)</span>
的递归判定，整体通常不划算。</p>
<p>当 <span class="math inline">\(k\)</span> 不大时用指数近似：<span
class="math inline">\(q^k=(1-p)^k
\approx  e^{-k(-\ln(1-p))}.\)</span>把阴性概率设成某个常数 <span
class="math inline">\(c\)</span>（例如 <span
class="math inline">\(q^k=c=e^{-2}\)</span>，那么解得<span
class="math inline">\(k \approx \dfrac{2}{-\ln(1-p)}\)</span></p>
<p>这一量级附近。实现上可以取一个上界<span
class="math inline">\(K=\lceil k\rceil +5\)</span></p>
<p>并且：</p>
<ul>
<li>在 <span class="math inline">\(F(n)\)</span> 中 <strong>始终额外把
<span class="math inline">\(k=n\)</span>
作为候选</strong>，因为全体先混一次是唯一可能显著大于 <span
class="math inline">\(K\)</span> 仍有价值的特殊情况）；</li>
<li>在 <span class="math inline">\(G(n)\)</span> 中只需枚举 <span
class="math inline">\(k\le \min(n-1,K)\)</span>。</li>
</ul>
<h2 id="代码">代码</h2>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> M = <span class="number">10000</span>;</span><br><span class="line"><span class="comment">// 经验上足够且极快的枚举上界：K ≈ 2 / (-ln(1-p))，再加一点安全余量</span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">max_k_cap</span><span class="params">(<span class="type">double</span> p, <span class="type">int</span> N)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> q = <span class="number">1.0</span> - p;</span><br><span class="line">    <span class="type">double</span> K = (<span class="number">-2.0</span>) / <span class="built_in">log</span>(q) + <span class="number">5.0</span>; <span class="comment">// 5 是安全余量</span></span><br><span class="line">    <span class="type">int</span> k = <span class="built_in">min</span>(<span class="built_in">max</span>(<span class="number">1</span>, (<span class="type">int</span>)<span class="built_in">floor</span>(K)), N);</span><br><span class="line">    <span class="keyword">return</span> k;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">double</span> <span class="title">solve_one_p</span><span class="params">(<span class="type">int</span> N, <span class="type">double</span> p)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> q = <span class="number">1.0</span> - p;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// P[k] = 1 - q^k : k 只羊混检为阳性的概率</span></span><br><span class="line">    <span class="function">vector&lt;<span class="type">double</span>&gt; <span class="title">P</span><span class="params">(N + <span class="number">1</span>, <span class="number">0.0</span>)</span></span>;</span><br><span class="line">    <span class="type">double</span> qpow = <span class="number">1.0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= N; ++k)</span><br><span class="line">    &#123;</span><br><span class="line">        qpow *= q;</span><br><span class="line">        P[k] = <span class="number">1.0</span> - qpow;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">vector&lt;<span class="type">double</span>&gt; <span class="title">F</span><span class="params">(N + <span class="number">1</span>, <span class="number">0.0</span>)</span>, <span class="title">G</span><span class="params">(N + <span class="number">1</span>, <span class="number">0.0</span>)</span></span>;</span><br><span class="line">    F[<span class="number">0</span>] = <span class="number">0.0</span>;</span><br><span class="line">    G[<span class="number">0</span>] = <span class="number">0.0</span>;</span><br><span class="line">    F[<span class="number">1</span>] = <span class="number">1.0</span>;</span><br><span class="line">    G[<span class="number">1</span>] = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="type">int</span> cap_global = <span class="built_in">max_k_cap</span>(p, N);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> n = <span class="number">2</span>; n &lt;= N; ++n)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 先算 G[n]</span></span><br><span class="line">        <span class="type">double</span> Pn = P[n];</span><br><span class="line">        <span class="type">int</span> capG = <span class="built_in">min</span>(n - <span class="number">1</span>, cap_global);</span><br><span class="line"></span><br><span class="line">        <span class="type">double</span> bestG = <span class="number">1e100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= capG; ++k)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">double</span> pk = P[k] / Pn; <span class="comment">// Pr(subgroup positive | whole positive)</span></span><br><span class="line">            <span class="type">double</span> val = <span class="number">1.0</span> + pk * (G[k] + F[n - k]) + (<span class="number">1.0</span> - pk) * G[n - k];</span><br><span class="line">            <span class="keyword">if</span> (val &lt; bestG)</span><br><span class="line">                bestG = val;</span><br><span class="line">        &#125;</span><br><span class="line">        G[n] = bestG;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 再算 F[n]</span></span><br><span class="line">        <span class="type">int</span> capF = <span class="built_in">min</span>(n, cap_global);</span><br><span class="line">        <span class="type">double</span> bestF = <span class="number">1e100</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">1</span>; k &lt;= capF; ++k)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">double</span> val = <span class="number">1.0</span> + F[n - k] + P[k] * G[k];</span><br><span class="line">            <span class="keyword">if</span> (val &lt; bestF)</span><br><span class="line">                bestF = val;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 额外把 k = n 作为候选：全体先混检一次</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="type">double</span> val_all = <span class="number">1.0</span> + P[n] * G[n];</span><br><span class="line">            <span class="keyword">if</span> (val_all &lt; bestF)</span><br><span class="line">                bestF = val_all;</span><br><span class="line">        &#125;</span><br><span class="line">        F[n] = bestF;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> F[N];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="type">double</span> total = <span class="number">0.0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">50</span>; ++i)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="type">double</span> p = <span class="number">0.01</span> * i;</span><br><span class="line">        total += <span class="built_in">solve_one_p</span>(M, p);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;%.6f\n&quot;</span>, total);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="reward-container">
  <div>请我一杯咖啡吧！</div>
  <button>
    赞赏
  </button>
  <div class="post-reward">
      <div>
        <img src="/images/wechatpay.png" alt="Ujimatsu Chiya 微信">
        <span>微信</span>
      </div>
      <div>
        <img src="/images/alipay.png" alt="Ujimatsu Chiya 支付宝">
        <span>支付宝</span>
      </div>

  </div>
</div>

          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Ujimatsu Chiya
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://ujimatsu-chiya.github.io/project-euler/352/" title="Project Euler 352">https://ujimatsu-chiya.github.io/project-euler/352/</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2022 – 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Ujimatsu Chiya</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">1.5m</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">22:47</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/mist/" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div><!-- 页面动态线条-->
<script color="0,0,255" opacity="0.5" zIndex="-1" count="99" src="https://lib.baomitu.com/canvas-nest.js/1.0.1/canvas-nest.js"></script>
<!-- 页面点击小红心
<script type="text/javascript" src="/js/click-love.js" />-->

<span id="sitetime"></span>
<script language=javascript>
function siteTime(){
    window.setTimeout("siteTime()", 1000);
    let seconds = 1000;
    let minutes = seconds * 60;
    let hours = minutes * 60;
    let days = hours * 24;
    let years = days * 365;
    let create_day = new Date("2022-03-25T13:14:23Z");
    let today = new Date();
    let awesome = "<i class=\"fa-solid fa-clock\"></i> "

    let diff = today-create_day;
    let diffSeconds = Math.floor(diff/seconds%60);
    let diffMinutes = Math.floor(diff/minutes%60);
    let diffHours = Math.floor(diff/hours%24);
    let diffDays = Math.floor(diff/days%365);
    let diffYears = Math.floor(diff/years);

    document.getElementById("sitetime").innerHTML=`自 ${create_day.getFullYear()} 年 ${create_day.getMonth() + 1} 月 ${create_day.getDate()} 日建立以来，本网站已运行： ${awesome} ${diffYears} 年 ${diffDays} 天 ${diffHours} 时 ${diffMinutes} 分 ${diffSeconds} 秒`;
}
siteTime();
</script>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"Ujimatsu-Chiya/Ujimatsu-Chiya.github.io-comment","issue_term":"pathname","theme":"github-light","crossorigin":"anonymous"}</script>
<script src="/js/third-party/comments/utterances.js" defer></script>

</body>
</html>
